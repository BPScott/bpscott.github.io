<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta content="IE=edge,chrome=1" http-equiv=X-UA-Compatible> <title>Reload.me.uk</title> <meta name=viewport content="width=device-width, initial-scale=1"> <link href='https://fonts.googleapis.com/css?family=Noto+Serif' rel=stylesheet> <link href="/stylesheets/all.css" rel=stylesheet /> <link rel=alternate type="application/atom+xml" title="Reload.me.uk - feed" href="http://feeds.feedburner.com/reloadmeuk"/> <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-4167857-1', 'auto');
      ga('send', 'pageview');
    </script> </head> <body class=index> <div class=page-wrapper> <header class=page-header> <div class=header-title> <h1><a href="/">Reload.me.uk</a></h1> </div> <div class=header-nav> <ul class="nav nav--global"> <li><a href="/">Words</a></li> <li><a href="/about/">About</a></li> </ul> </div> </header> <div class=page-content> <article class="article article--in-list"> <header> <h1 class=article__title><a href="/2017/developing-in-the-open/">Developing in the Open</a></h1> <p class=article__meta> Posted on <time datetime=2017-04-18>Apr 18 2017</time> </p> </header> <p>&ldquo;Hey Ben what have you been working on recently?&rdquo; is a question that usually ends in a lengthy answer about new work stuff and how I&#39;m excited for the future but usually no code links to <em>show</em> what I&#39;ve been <del>playing</del> working on. Until now at least. This is because the team behind <a href="http://www.bbc.co.uk/programmes">bbc.co.uk/programmes</a> is switching to a &ldquo;Developing in the Open&rdquo; mindset for our new projects. This is a process popularised by <a href="https://www.gov.uk/service-manual/technology/making-source-code-open-and-reusable">GDS</a>, <a href="https://www.theguardian.com/info/developer-blog/2014/nov/28/developing-in-the-open">The Guardian</a>, and <a href="https://github.com/financial-times">The Financial Times</a>.</p> <p>The BBC has a long tradition of publishing <a href="http://www.bbc.co.uk/opensource">Open Source</a> software and has used Developing in the Open for internal-use libraries such as Sport&#39;s <a href="https://github.com/bbc/grandstand">Grandstand</a> CSS framework, but I think this might be the first instance of opening up the application code that is used to directly power BBC systems.</p> <p>Here&#39;s a little primer on what that means and what the team had to go through to get to this point.</p> <h2>What is Developing in the Open?</h2> <p>Developing in the Open is having your source code publicly accessible and licensed and thus available to be seen and used by all. This is very similar to the traditional model you think of when you hear &ldquo;Open Source&rdquo;, however there is a crucial difference. Open Source is for projects that you expect other people to use and contribute to, while Developing in the Open offers no such expectation.</p> <p>As the code we are publicising is specifically for our team&#39;s needs, nobody else would find value in copying the whole thing verbatim and thus wouldn&#39;t be interested in providing patches. Though I&#39;m sure some people will make some typo fixes in our READMEs so they get marked as having contributed to a BBC repo. However that doesn&#39;t mean we should hide our code away - there is still value in small portions of the app: a reusable CSS utility, or how to structure a set of domain models would be useful things that other people can see and make use of.</p> <p>It&#39;s an inversion of the classical belief that things should be hidden by default - instead lets make things visible by default and only hide that which is sensitive. If something isn&#39;t worth selling, then why not offer it for free?</p> <h2>Why Develop in the Open?</h2> <p>The big, selfish reason is a sense of pride. We&#39;re working on applications we&#39;re proud of, both in terms of output and how they&#39;re put together. We should be able to show the world what we&#39;ve made.</p> <p>Occasionally we come up with something we think is worth sharing, such as <a href="http://codepen.io/BPScott/pen/NGPMQQ">a CSS utility to deal with image ratios</a>, <a href="http://codepen.io/BPScott/pen/QbXBjo">a neat naming convention for grid width classes</a>, or even a <a href="https://www.youtube.com/watch?v=qSrM411MD8A">methodology for structuring a design system</a> and having our code be open allows us to show people those things within the context of our applications, in addition to creating toy demo examples.</p> <p>It helps improve our code quality. We have to be stricter about following best practices instead of giving into the temptation of getting sloppy and we&#39;ll feel more compelled to produce higher quality code / commit messages if we know there&#39;s a chance more people shall read what we produce.</p> <p>The Ministry of Justice recently put out a blog post about <a href="https://mojdigital.blog.gov.uk/2017/02/21/why-we-code-in-the-open/">why they code in the open</a> that covers a couple of other pros.</p> <h2>Due Diligence</h2> <p>Moving to an open by default model does have some risks. You need to be more careful about how you handle sensitive data such as passwords, API keys and information that may give malicious outsiders too much information. Ideally you should already be mindful about these things - storing secrets in a private place that is then merged with your public code using <a href="https://12factor.net/config">environment variables</a> or some other mechanism as part of your deployment process.</p> <p>Ensuring nothing sensitive gets into the repo is an ongoing process and should anything sensitive be accidentally committed then the secret should be revoked and changed immediately. Fortunately we are petty good at this already, our secrets are stored in a separate system - Cosmos - the BBC&#39;s in-house deployment tooling.</p> <p>As we are opening up projects that have already been in active development we had to go audit the history of the project to ensure nothing sensitive existed in the repo.</p> <p>We found no passwords but we stored our AWS infrastructure configuration - <a href="https://aws.amazon.com/cloudformation/">CloudFormation templates</a> and the <a href="https://github.com/cloudtools/troposphere">Troposphere</a> config that builds them as part of the repository. While this information is not instantly recognisable as sensitive - it is a template we fill with precise values at a later point - we decided that there is no value in exposing this information. The templates are equivalent to a blueprint of a house - any potential bad-actor would be able to work it out should they get inside, but that doesn&#39;t mean we should tell them the layout up front. This configuration was purged from our git history using <code>git filter-branch</code>, following <a href="https://help.github.com/articles/removing-sensitive-data-from-a-repository/">GitHub&#39;s guide for removing sensitive data</a>.</p> <p>GDS have wrote a couple of articles about other things to consider when opening up a code base and when it might not be appropriate:</p> <ul> <li><a href="https://www.gov.uk/service-manual/technology/making-source-code-open-and-reusable">GDS service manual on making code open</a></li> <li><a href="https://gds.blog.gov.uk/2014/10/08/when-is-it-ok-not-to-open-all-source-code/">When is it ok not to open all source code?</a></li> <li><a href="https://gdstechnology.blog.gov.uk/2016/01/26/working-out-how-to-open-up-the-register-to-vote-code/">Working out how to open up the Register to Vote code</a></li> </ul> <h2>Licensing</h2> <p>By default a person (or team) retains the rights to their own work and thus nobody else may used that work. You need to explicitly include a LICENSE file in your repository to loosen or change those rights if you want other people to be able to use your work without fear of repercussion. <a href="https://choosealicense.com/">choosealicence.com</a> provides a list of licenses suitable for open-source that allows other people to use your work, roughly ranked in order of restrictiveness.</p> <p>For the my team&#39;s projects we wanted to allow anybody to be able to use our code in any project. We don&#39;t want a viral copyleft license like <a href="https://choosealicense.com/licenses/agpl-3.0/">AGPL</a> that enforces any project that takes code from our repo to also be openly licensed under the same terms. Making a project have to change its license if they wish to use a neat CSS pattern we created is unreasonably heavy handed.</p> <p>We also want to retain the rights to any patentable work. Software patents are idiotic, but by us asserting that we own the right to patent anything we produce, we stop somebody else taking our work and patenting it (and profiting off it) themselves.</p> <p>The license we chose is the <a href="https://choosealicense.com/licenses/apache-2.0/">Apache 2.0 License</a>. This offers us patent protection, which its nearest sibling the <a href="https://choosealicense.com/licenses/mit/">MIT License</a> does not - this is pretty much the only difference between the two. It also does not enforce a license on any projects that use any of our code. This is the &ldquo;standard&rdquo; license that be BBC uses for its open-source works and also what the <a href="https://github.com/guardian/frontend">Guardian</a> uses for its webapp code.</p> <h2>Conclusion</h2> <p>A list of our public repositories can be found on GitHub, tagged with <a href="https://github.com/search?q=topic%3Abbc-programmes+org%3Abbc&amp;type=Repositories">bbc&#8209;programmes</a>. Of particular note right now are:</p> <ul> <li><a href="https://github.com/bbc/programmes-pages-service">programmes-pages-service</a> - A PHP library containing our Database schema, domain models and tools to request data from our Database. Our new model layer.</li> <li><a href="https://github.com/bbc/programmes-clifton">programmes-clifton</a> - A JSON API powered by Symfony 3, using programmes-pages-service. It is a drop-in replacement for a legacy API, so we can continue to produce pages using the the existing <a href="http://www.bbc.co.uk/programmes">www.bbc.co.uk/programmes</a> frontend while we work on its replacement.</li> <li><a href="https://github.com/bbc/programmes-frontend">programmes-frontend</a> - The new Symfony 3 powered web app that shall eventually power <a href="http://www.bbc.co.uk/programmes">www.bbc.co.uk/programmes</a>. This is very, very work-in-progress right now and we&#39;re still working out how it&#39;ll all fit together.</li> </ul> </article> <article class="article article--in-list"> <header> <h1 class=article__title><a href="/2014/bower-vs-npm-for-packaging-sass/">Bower vs. npm for packaging Sass</a></h1> <p class=article__meta> Posted on <time datetime=2014-08-01>Aug 1 2014</time> </p> </header> <p>Package managers for the front end. Fun eh? I&#39;m about to be playing with creating a modular CSS framework that needs to be shared across applications, so I figured now would be a good time to investigate the tools available. As nobody else seems to have done this with a specific eye to CSS I might as well write about it too. Here is my use-case:</p> <ul> <li>I&#39;m building a CSS framework, written in Sass (though this investigation&#39;s outcome would apply to all CSS preprocessors).</li> <li>I&#39;ll have some fundamental mixins and functions, which shall be used by multiple components, these components shall then be included into my application.</li> <li>My build pipeline shall be using Grunt.</li> </ul> <p>There are two package managers on my shortlist: npm and Bower. Both are generic package managers. Both make you specify your dependencies in json files. Both install their dependencies into a folder within your application. At first glance they are very similar and my initial gut feeling was &ldquo;if I&#39;m already using npm for Grunt then why do I need Bower?&rdquo;. Why complicate the project with an additional package manager? There must be something I&#39;m missing.</p> <p>The key difference between the two lies in <a href="http://stackoverflow.com/questions/18641899/difference-between-bower-and-npm/18652918#18652918">how they store dependent packages</a>. Bower has a flat listing, while npm uses a nested hierarchy. To demonstrate this difference lets use a couple of hypothetically named packages, that map neatly onto a real world example used by the Guardian:</p> <ul> <li>Application - your app (e.g. The Guardian website) - which depends on:</li> <li>Component - a generic reusable CSS object (e.g. <a href="https://github.com/guardian/guss-layout">guss-layout</a>) - which depends on:</li> <li>Helper - a selection of utility Sass mixins / functions (e.g. <a href="https://github.com/guardian/sass-mq">sass-mq</a>)</li> </ul> <p>This is a drastically simplified example with a single component and helper, but think about how this can expand when there is multiple component packages each depending on various helper packages.</p> <h2>Bower&#39;s flat listing</h2> <p>Bower flattens your dependency graph and installs all dependencies at the same level, so after running <code>bower install</code> the application folder would like this:</p> <div class=highlight><pre class="highlight plaintext"><code>|--- bower_components
|    |--- component
|    |    |--- _component.scss
|    |--- helper
|    |    |--- _helper.scss
|--- bower.json
|--- styles.scss
</code></pre></div> <p>This is really simple, but it can potentially pose a major problem - dependency hell, which can occur when multiple components rely on different versions of the same helper. Because Bower does not allow installing two versions of the same package everything grinds to a halt.</p> <p>Bower&#39;s flat listing means that the path to all of the app&#39;s dependencies are one level deep so the app&#39;s <code>styles.css</code> would look like this:</p> <div class=highlight><pre class="highlight scss"><code><span class="k">@import</span> <span class="s1">'bower_components/helper/helper'</span><span class="p">;</span>
<span class="k">@import</span> <span class="s1">'bower_components/compoent/component'</span><span class="p">;</span>
</code></pre></div> <p>This can be tidied up by adding <code>bower_components</code> to the Sass load_path to save repeating it every time:</p> <div class=highlight><pre class="highlight scss"><code><span class="k">@import</span> <span class="s1">'helper/helper'</span><span class="p">;</span>
<span class="k">@import</span> <span class="s1">'compoent/component'</span><span class="p">;</span>
</code></pre></div> <p>Very neat and tidy.</p> <h2>Npm&#39;s dependency tree</h2> <p>Npm keeps the dependency tree intact, installing each package&#39;s dependencies into a <code>node_modules</code> folder within that package, so after running <code>npm install</code> the application folder would look like this:</p> <div class=highlight><pre class="highlight plaintext"><code>|--- node_modules
|    |--- component
|    |    |--- _component.scss
|    |    |--- node_modules
|    |    |    |--- helper
|    |    |    |    |--- _helper.scss
|--- package.json
|--- styles.scss
</code></pre></div> <p>This layout is a bit more complex than Bower&#39;s flat listing, but it avoids dependency hell as each component is responsible for its own dependencies rather than having them all merged into the same level.</p> <p>This nested dependency graph means the app&#39;s stylesheet&#39;s <code>@imports</code> end up looking a little uglier than the Bower version:</p> <div class=highlight><pre class="highlight scss"><code><span class="k">@import</span> <span class="s1">'node_modules/component/node_modules/helper/helper'</span><span class="p">;</span>
<span class="k">@import</span> <span class="s1">'node_modules/compoent/component'</span><span class="p">;</span>
</code></pre></div> <p>All this nesting means there isn&#39;t much value in adding <code>node_modules</code> to the load path as there is still a load of node_modules references at lower levels littering the <code>@import</code> paths anyway.</p> <h2>Unavoidable Dependency Hell</h2> <p>The thing is though, npm&#39;s resolution to dependency hell works great for JS modules where you can scope the inclusion of a particular version of a helper to a particular component. Sass has no such scoping though. You can only import files into the global scope which means that any mixins and functions contained within them also live in the global scope. Sass does not complain about overwriting an existing mixin or function, which can lead to subtle and insidious bugs when one version of a helper overwrites a different one and gets used within a component that does not support it.</p> <p>It&#39;s a potential minefield and I can&#39;t come up with a way out of this mismatched dependency thing in Sass other than being careful not to fall prey to it in the first place. Which can be done by being careful about not breaking backwards compatibility in your helper&#39;s API, or when you do inevitably break it, you have to upgrade everything that depends on that helper all at the same time. It&#39;s a sucky problem but really your helpers should be so simple that you will not need to update them in a way that breaks prior expectations anyway. As the old joke goes: &ldquo;Doctor doctor, it hurts when I do <strong>this</strong>&rdquo; &ldquo;Well, don&#39;t do it then&rdquo;. Not got a better solution that the utterly unhelpful &ldquo;you just need to <strong>know</strong> when you&#39;re about to do it wrong&rdquo;, sorry.</p> <p>So, npm&#39;s nested dependency tree is not actually a feature that is relevant to writing a Sass framework anyway as Sass does not support that sort of scoping. Which means that Bower is looking a lot nicer due to its simpler folder structure (as npm&#39;s apparent complexity does not help solve anything in Sass-land) and its ability to give bit of sugar around load paths. Balls, this wasn&#39;t the answer I was hoping for, I don&#39;t want to require a second package manager. What if I can make npm use a flat folder structure like Bower?</p> <h2>NPM Peer Dependencies</h2> <p>What if I fiddle with that dependency graph a little bit. What if I say that a component should not be responsible for loading in the helpers it needs, but instead should trust that the application has already loaded a compatible version of the helper that is available for the component to use. It means your components break if you do not include that helper in your application&#39;s scss file but it seems like a small price to pay for ensuring you are only pulling in a single version of your helpers. It sounds daft and horrible but it might get us out of this.</p> <p>Here is the revised dependency chain, where the application explicitly states that it requires Component and Helper, and Component hints that it needs a specific version of Helper:</p> <ul> <li>Application - your app (e.g. The Guardian website) - which depends on: <ul> <li>Component (hinted: I need Helper to be included before me)</li> <li>Helper</li> </ul></li> </ul> <p>NPM has support for this hinting of things a component needs, but never calls directly as a feature called <a href="http://blog.nodejs.org/2013/02/07/peer-dependencies/">peer dependencies</a>. By specifying the helper as a peer dependency npm shall throw a error if two components attempt to rely on two different versions of a single helper.</p> <p>The component&#39;s <code>package.json</code> would look like:</p> <div class=highlight><pre class="highlight javascript"><code><span class="p">{</span>
  <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"component"</span><span class="p">,</span>
  <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"1.0.0"</span><span class="p">,</span>
  <span class="s2">"dependencies"</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">"devDependencies"</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">"peerDependencies"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"helper"</span><span class="p">:</span> <span class="s2">"~1.0.0"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> <p>The app&#39;s <code>package.json</code> would look like this:</p> <div class=highlight><pre class="highlight javascript"><code><span class="p">{</span>
  <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"myApp"</span><span class="p">,</span>
  <span class="s2">"dependencies"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"helper"</span><span class="p">:</span> <span class="s2">"~1.0.0"</span><span class="p">,</span>
    <span class="s2">"component"</span><span class="p">:</span> <span class="s2">"~1.0.0"</span>
  <span class="p">},</span>
  <span class="s2">"devDependencies"</span><span class="p">:</span> <span class="p">{},</span>
  <span class="s2">"peerDependencies"</span><span class="p">:</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div> <p>When you run <code>npm install</code> in your application&#39;s tree shall look like:</p> <div class=highlight><pre class="highlight plaintext"><code>|--- node_modules
|    |--- component
|    |    |--- _component.scss
|    |--- helper
|    |    |--- _helper.scss
|--- package.json
|--- styles.scss
</code></pre></div> <p>And thus your app&#39;s stylesheet would look like:</p> <div class=highlight><pre class="highlight scss"><code><span class="k">@import</span> <span class="s1">'node_modules/helper/helper'</span><span class="p">;</span>
<span class="k">@import</span> <span class="s1">'node_modules/compoent/component'</span><span class="p">;</span>
</code></pre></div> <p>Currently peer dependencies are installed automatically and npm throws an error when packages want to install conflicting versions of a peer dependency, so we don&#39;t really need to explicitly specify them in the application&#39;s package.json. However the npm maintainers <a href="https://github.com/npm/npm/issues/5080#issuecomment-40771461">don&#39;t like the idea of peer dependencies in this form</a>. They would rather change it so that peerDependencies are not installed automatically and that npm would warn rather than error when there are peer dependency conflicts. I would rather be a bit more explicit in the application&#39;s package.json to be ready for that impending change. So now we have that flat Bower-like layout that we were hoping for, at the expense of having to write a little more in our package.json manifest file. I&#39;m pretty happy with that.</p> <h2>Conclusion</h2> <p>The more I sit and thing about this, the more I think that using npm with peerDependencies is a good idea. It is not <strong>explicitly</strong> what peerDependencies was originally envisioned for, but I think it seems like a good ideological fit and certainly appears to solve the problem - while keeping build-time complexity down thanks to not needing the overhead of Bower. <a href="https://twitter.com/BPScott">Please tell me if I&#39;m crazy</a>.</p> </article> <article class="article article--in-list"> <header> <h1 class=article__title><a href="/2013/powered-by-middleman/">Powered By Middleman</a></h1> <p class=article__meta> Posted on <time datetime=2013-04-26>Apr 26 2013</time> <span class=article__tags>in: (<a href="/tags/middleman/">Middleman</a>) </span> </p> </header> <p>I started using static site generators some time last year, beginning with probably the most well known: <a href="http://jekyllrb.com/">Jekyll</a>, which powers GitHub Pages. I found it ideal for creating simple sites with no need for interactivity that can be deployed anywhere (due to being pure html/css/js) while still allowing me control over the build process and asset optimisation.</p> <p>Jekyll&#39;s focus is on being minimal, lean and slightly opinionated and I was getting tired of having to implement functionality I wanted as plugins. If only there was some tool that concerned itself with front-end best practices like concatenation and minification of CSS and JavaScript and offered tooling like LiveReload as standard&hellip;</p> <h2>Enter Middleman</h2> <p><a href="http://middlemanapp.com/">Middleman</a> is a full-fat static site generator that cares about optimisation and developer joy out of the box (or via offical extensions). A quick list of things that I had to implement in Jekyll that are easy in Middleman:</p> <ul> <li><a href="http://sass-lang.com/">Sass</a> and <a href="http://compass-style.org/">Compass</a> support is standard thanks to the Sprockets asset pipeline.</li> <li>JavaScript concatentation and minification is also handled by Sprockets.</li> <li>HTML minification is handled by <a href="https://github.com/middleman/middleman-minify-html">middleman-minify-html</a>.</li> <li>Deployment to GitHub Pages (or ftp/rsync) is handled by <a href="https://github.com/tvaughan/middleman-deploy">middleman-deploy</a>.</li> <li>Live reload is handled by <a href="https://github.com/middleman/middleman-livereload">middleman-livereload</a>.</li> </ul> <p>Naturally this site is built using Middleman and published onto GitHub Pages, and the source to generate it is available on <a href="https://github.com/BPScott/bpscott.github.io">my GitHub account</a>.</p> </article> <article class="article article--in-list"> <header> <h1 class=article__title><a href="/2010/tubewhack/">Tubewhack</a></h1> <p class=article__meta> Posted on <time datetime=2010-03-13>Mar 13 2010</time> </p> </header> <p><em>This is a backdated post from way back in the day</em></p> <p>Based on a suggestion in <a href="http://www.b3ta.com/newsletter/issue419/">b3ta newsletter #419</a> I have created <a href="/tubewhack">Tubewhack</a>; a tool that lets you find words whose letters appear in a single tube station name. For instance: Pimlico is the only Underground station which does not contain any of the letters in the word &ldquo;badger&rdquo;.</p> <p></p> <p>Credit for the name goes to <a href="http://twitter.com/djmarland">@djmarland</a> as Tubewhack is considerably more succinct than &ldquo;Words Not Contained In Tube Names&rdquo;.</p> </article> <article class="article article--in-list"> <header> <h1 class=article__title><a href="/2009/kittenify-bookmarklet/">Kittenify Bookmarklet</a></h1> <p class=article__meta> Posted on <time datetime=2009-08-07>Aug 7 2009</time> </p> </header> <p><em>This is a backdated post from way back in the day</em></p> <p>Based on a suggestion in <a href="http://www.b3ta.com/newsletter/issue390/">b3ta newsletter #390</a> I have created <a href="/kittenify">Kittenify</a>; a little bookmarklet that replaces all images on the current page with pictures of kittens pulled from Flickr.</p> <p></p> <p><strong>One Week Later</strong>: WOO and YAY I&#39;ve made it into <a href="http://www.b3ta.com/newsletter/issue391/">b3ta newsletter #391</a> twice. Once for the bookmarklet itself, and again for getting b3ta a bit of media coverage as Kittenfy appeared in both the <a href="http://theridiculant.metro.co.uk/2009/08/kittens-kittens-everywhere.html">online</a> and <a href="http://www.flickr.com/photos/robmanuel/3807086473">print</a> editions of the Metro newspaper.</p> </article> </div> <footer class=page-footer> </footer> </div> <div class=page-footer-outer> <p class=copy-info> &copy; Ben Scott 2018. @BPScott on <a href="https://twitter.com/BPScott">Twitter</a> and <a href="https://github.com/BPScott">GitHub</a>. </p> </div> </body> </html>